#!/bin/bash

# FileSystemKit Pre-commit Hook
# Checks if CHANGELOG.md has been modified
#
# To install: cp scripts/hooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

CHANGELOG="CHANGELOG.md"
STAGED_FILES=$(git diff --cached --name-only)

# Check if CHANGELOG.md is being committed
if echo "$STAGED_FILES" | grep -q "^$CHANGELOG$"; then
    echo "✓ CHANGELOG.md is included in this commit"
    exit 0
fi

# Check if there are any source or documentation changes
SOURCE_CHANGES=$(echo "$STAGED_FILES" | grep -E "\.(swift|md)$" | grep -v "^$CHANGELOG$")

if [ -n "$SOURCE_CHANGES" ]; then
    echo "⚠️  WARNING: You have source/documentation changes but CHANGELOG.md is not staged."
    echo "   Consider updating CHANGELOG.md before committing."
    echo ""
    echo "   To skip this check: git commit --no-verify"
    echo ""
    read -p "   Continue anyway? (y/N) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

exit 0

